<div ng-include="'Projects/nav.html'"></div>

<div ng-controller="ViewCtrl_Robot">
    <table id="robot-header" style="width:90%; margin-left:5%; font-family:'Times New Roman'">
        <tr>
            <td colspan="2">
                <p align="center" style="font-size:5vw">
                    Robot Dog
                </p>
            </td>
        </tr>
        <tr>
            <td style="width:25%">
                <p align="center" style="background-color:lightblue; margin-bottom:0px; border: 1px solid #00000a; font-size:2vw">
                    Table of Contents
                </p>
            </td>
            <td>
                <P ALIGN=RIGHT STYLE="margin-bottom:0px; font-size:2vw">
                    Alex Vassallo - January 2016
                </P>
            </td>
        </tr>
        <tr>
            <td style="vertical-align:top">
                                    
                <ol style="background-color:lightblue; border: 1px solid #00000a; padding: 0in 12%; font-size:2vw">

                    <li><div ng-click="gotoChpt1()">Abstract</div></li>
                    <li>
                        <div ng-click="gotoChpt2()">Hardware</div>
                        <ol>

                            <li><div ng-click="gotoChpt21()">System Schematic</div></li>
                            <li><div ng-click="gotoChpt22()">Frame</div></li>
                            <li><div ng-click="gotoChpt23()">Legs</div></li>
                            <li><div ng-click="gotoChpt24()">Rear Power</div></li>
                            <li><div ng-click="gotoChpt25()">Front Power</div></li>
                            <li><div ng-click="gotoChpt26()">System Board</div></li>
                            <li><div ng-click="gotoChpt27()">Servos</div></li>
                            <li><div ng-click="gotoChpt28()">Radar</div></li>
                        </ol>
                    </li>
                    <li>
                        <div ng-click="gotoChpt3()">Software</div>

                        <ol>

                            <li><div ng-click="gotoChpt31()">Leg Geometry</div></li>
                            <li><div ng-click="gotoChpt32()">Pivot Compensation</div></li>
                            <li><div ng-click="gotoChpt33()">Graphics</div></li>
                            <li><div ng-click="gotoChpt34()">Auto-Level</div></li>
                            <li><div ng-click="gotoChpt35()">Walking</div></li>
                            <li><div ng-click="gotoChpt36()">Radar</div></li>
                            <li><div ng-click="gotoChpt37()">Current Development</div></li>
                            <li><div ng-click="gotoChpt38()">Software Outline</div></li>
                        </ol>
                    </li>
                </ol>
      
            </td>
            <td style="vertical-align:top">
                <IMG style="display:block; width:95%; margin-left:5%" SRC="Projects/Robot/img/i_2a584a74ff33d10d_html_ee30fdcb.jpg" NAME="Picture 3">
            </td>
        </tr>
    </table>



    <div style="margin-left:5%; margin-right:5%; font-family:'Times New Roman'; font-size:2vw">


        <P><BR><BR><BR><BR></P>

        <P STYLE="font-size:5vw">
            <a name="chpt1">1 Abstract</a>
        </P>

        <P ALIGN=JUSTIFY>
                This design was created as a midterm project for the Embedded
                Systems class at the University of Washington.  The assignment was to
                implement any design that utilized the Teensy 3.1 microcontroller and
                various peripherals of our choice, within 2 weeks. I decided to use
                my mechanical skills to develop a robot that uses PWM servos. For
                mobility, the overall design of this project was based on my dog.
                Each leg is connected to two heavy-duty servos which allows precise
                control of each foot placement.  The power grid was designed to
                deliver up to 25 Amps of current to manipulate each of the leg servos
                to do various commands.  There is an additional servo mounted to the
                pivot point at the waist that allows up to 30 degrees of left/right
                rotation, and another servo mounted to a &quot;neck&quot; to rotate a
                range finder and produce a radar map to locate open routes and
                objects. The accelerometer and gyro unit, located on the system
                board, sends data to a quaternion algorithm to calculate yaw, pitch,
                and roll. This allows for a feedback system to keep the robot level
                by adjusting the height of each leg. An LCD screen is used to display
                data, including line drawings of each leg's current position.
                Currently, commands are entered into a startup script inside the
                source code, but development of a wireless command system is in
                progress.
        </P>

        <P><BR><BR><BR><BR></P>

        <P STYLE="font-size:5vw">
            <a name="chpt2">2 Hardware</a>
        </P>
        <p style="font-size:3vw">
            <a name="chpt21">2.1	System Schematic</a>
        </p>

        <P ALIGN=CENTER>
            <IMG style="display:block; width:60%" SRC="Projects/Robot/img/i_2a584a74ff33d10d_html_c53d4ea0.png" NAME="Picture 0"><br />
            <i>Figure 1: Schematic</i>
        </P>

        <P STYLE="margin-bottom: 0in">
            <BR><BR><BR><BR>
        </P>
        <p style="font-size:3vw">
            <a name="chpt22">
                2.2 Frame
            </a>
        </p>

        <table style="width:100%">
            <tr>
                <td style="width:55%">
                    <P ALIGN=JUSTIFY>
                        The prototype frame was constructed from modified Erector set parts and
                        various linkages found at a local hobby store. It was designed to
                        maintain a center of gravity that was low and in the center of the
                        leg distribution. Figure 2 shows the geometry of the frame, and the
                        red dots represent the feet inside of their range of motion with
                        contact along the ground. In this diagram, the feet are placed in the
                        center of motion and the center of gravity is marked at the pivot
                        point of the frame, which is also geometrically the center of the
                        foot distribution. By pivoting the frame, the center of gravity can
                        be altered left or right. By placing all the hardware evenly along
                        the frame, the weight distribution can be evenly maintained and
                        gyroscopic balance can be used to achieve complex motions such as
                        walking.
                    </P>
                </td>
                <td>
                    <IMG style="display:block; width:100%" SRC="Projects/Robot/img/i_2a584a74ff33d10d_html_9ab3eeda.jpg" NAME="Picture 5">
                    <P ALIGN="CENTER" STYLE="font-size:2vw">
                        <i>Figure 2: Frame Layout</i>
                    </P>
                </td>
            </tr>
        </table>

        <P STYLE="margin-bottom: 0in">
            <BR><BR>
        </P>

        <table style="width:100%">
            <tr>
                <td style="width:50%">
                    <IMG style="display:block; width:100%" SRC="Projects/Robot/img/i_2a584a74ff33d10d_html_d78be2ca.jpg" NAME="Picture 14">
                </td>
                <td style="width:50%">
                    <IMG style="display:block; width:100%" SRC="Projects/Robot/img/i_2a584a74ff33d10d_html_5640b87c.jpg" NAME="Picture 16">
                </td>
            </tr>
            <tr>
                <td colspan="2">
                    <p ALIGN="CENTER" style="font-size:2vw">
                        <I>Empty Metal Frame</I>
                    </p>
                </td>
            </tr>

        </table>

        <P><BR><BR><BR><BR /></P>


        <P STYLE="font-size:3vw">
            <a name="chpt23">2.3 Legs</a>
        </P>

        <p ALIGN="justify">
            The hardware for the legs is
            modeled from my pet dog and includes various linkages to reduce the
            amount of muscle inputs needed. The target of this design was to
            allow for a wide range of motion while keeping the feet in alignment
            with the ground. Pivot points were carefully calculated to allow the
            servos full range of motion as they manipulate the legs.  Figure 3
            shows some various positions and how the hardware functions together.
            The servo arms are in Green, hard linkages are in Red, and Blue dots
            represent load bearing bushings.
        </p>

        <table style="width:100%">
            <tr>
                <td style="width:18%">
                    <IMG style="display:block; width:100%" SRC="Projects/Robot/img/i_2a584a74ff33d10d_html_910f5ff8.jpg" NAME="Picture 21">
                </td>

                <td style="width:29%">
                    <img style="display:block; width:100%" src="Projects/Robot/img/i_2a584a74ff33d10d_html_8416a759.png" name="Picture 1">
                </td>

                <td style="width:42%">
                    <IMG style="display:block; width:100%" SRC="Projects/Robot/img/i_2a584a74ff33d10d_html_3ba28d73.jpg" NAME="Picture 13">
                </td>
            </tr>
            <tr>
                <td colspan="3">
                    <P ALIGN=CENTER>
                        <i>Figure 3: Leg Telemetry</i>
                    </P>
                </td>
            </tr>
        </table>

        <P><BR><BR><BR><BR></P>

        <P STYLE="font-size:3vw">
                <a name="chpt24">2.4 Rear Power Grid</a>
        </P>

        <P ALIGN=JUSTIFY>
            The servo specifications show that their supply voltage can range from
            4.2V to 6V and the maximum current draw is 3 Amps each.  To provide
            this power to each servo, adjustable voltage regulation in the form
            of step-down converters are connected to each servo's power supply.
            The output voltage of each voltage converter is adjusted to 5.5V to
            allow maximum torque at each servo, while leaving 0.5V of room for
            inductive spikes from the motors.  Step-down converters were chosen
            for their efficiency to reduce overhead power loss as well as heat
            production. Each voltage converter is soldered together into a
            &quot;stack&quot;, and then a junction board with external
            connections is soldered onto one edge. To allow the power switch and
            power plug to be accessible from the rear, they were attached
            directly to the rear PCB assembly to allow solid connections to the
            power source.
        </P>

        <table style="width:100%">
            <tr>
                <td style="width:50%">
                    <IMG style="display:block; width:100%" SRC="Projects/Robot/img/i_2a584a74ff33d10d_html_abcf0487.jpg" NAME="Picture 24">
                    <P ALIGN=CENTER>
                        <I>Rear Step-down converter assembly</I>
                    </P>
                </td>
                <td>
                    <IMG style="display:block; width:100%" SRC="Projects/Robot/img/i_2a584a74ff33d10d_html_c7b6c483.jpg" NAME="Picture 23">
                    <P ALIGN=CENTER>
                        <I>Installed into frame</I>
                    </P>
                </td>
            </tr>
        </table>

        <P><BR><BR><BR><BR></P>

        <P ALIGN=JUSTIFY>
            Large 470uF capacitors are connected in parallel with the step-down
            converters to supply a steady current when the large inductive spikes
            from the servo motors occur. The size of these capacitors have been
            calculated to restrict inductive voltage spikes to less than 0.5V,
            plus or minus.
        </P>

        <table style="width:100%">
            <tr>
                <td style="width:50%">
                    <IMG style="display:block; width:100%" SRC="Projects/Robot/img/i_2a584a74ff33d10d_html_dcb4f5d4.jpg" NAME="Picture 26">
                    <P ALIGN=CENTER>
                        <I>(5x) 470uF Electrolytic Capacitors</I>
                    </P>
                </td>
                <td>
                    <IMG style="display:block; width:100%" SRC="Projects/Robot/img/i_2a584a74ff33d10d_html_6aafa9f9.jpg" NAME="Picture 27">
                    <P ALIGN=CENTER>
                        <I>Installation</I>
                    </P>
                </td>
            </tr>
        </table>

        <P><BR><BR><BR><BR></P>

        <P STYLE="font-size:3vw">
            <a name="chpt25">2.5 Front Power Grid</a>
        </P>

        <P ALIGN=JUSTIFY>
            Similar to the rear power grid, the front power grid also uses step-down
            converters coupled with 470uF capacitor to supply a smooth current
            flow to each servo. Unlike the rear, all the components have been
            packaged together into a cube that fits inside of a frame cage. The
            5th step-down converter supplies the microcontroller and peripherals
            with a steady 5V power supply. That output is coupled to a much
            smaller capacitor and a diode to prevent USB power from feeding back
            into the power system.
        </P>

        <table style="width:100%">
            <tr>
                <td style="width:50%">
                    <IMG style="display:block; width:100%" SRC="Projects/Robot/img/i_2a584a74ff33d10d_html_52ea3f6d.jpg" NAME="Picture 28">
                    <P ALIGN=CENTER>
                        <I>Component Assembly</I>
                    </P>
                </td>
                <td>
                    <IMG style="display:block; width:100%" SRC="Projects/Robot/img/i_2a584a74ff33d10d_html_ee07d1dc.jpg" NAME="Picture 29">
                    <P ALIGN=CENTER>
                        <I>Final Assembly</I>
                    </P>
                </td>
            </tr>
        </table>

        <P STYLE="margin-bottom: 0in">
            <BR><BR><BR><BR>
        </P>

        <table style="width:100%">
            <tr>
                <td style="width:50%">
                    <IMG style="display:block; width:100%" SRC="Projects/Robot/img/i_2a584a74ff33d10d_html_cbd375ec.jpg" NAME="Picture 30">
                    <P ALIGN=CENTER>
                        <I>View From Left</I>
                    </P>
                </td>
                <td>
                    <IMG style="display:block; width:100%" SRC="Projects/Robot/img/i_2a584a74ff33d10d_html_218b2895.jpg" NAME="Picture 31">
                    <P ALIGN=CENTER>
                        <I>View From Right</I>
                    </P>
                </td>
            </tr>
        </table>

        <P><BR><BR><BR><BR></P>

        <P STYLE="font-size:3vw">
            <a name="chpt26">2.6 System Board</a>
        </P>

        <P ALIGN=JUSTIFY>
            The System Board was designed to allow easy connections with external
            devices, and to fit within the size limits of the frame.  All pins
            and connectors were soldered underneath to match the system
            schematic.  Servo signal wires are color coded for identification,
            and a partial strip of grey IDE cable was used to connect the LCD
            screen. A diode allows the System Board to be powered from the
            on-board power grid, or from USB power.
        </P>

        <table style="width:100%">
            <tr>
                <td style="width:50%">
                    <IMG style="display:block; width:100%" SRC="Projects/Robot/img/i_2a584a74ff33d10d_html_c588c676.jpg" NAME="Picture 34">
                    <P ALIGN=CENTER>
                        <I>Component Connections</I>
                    </P>
                </td>
                <td>
                    <IMG style="display:block; width:100%" SRC="Projects/Robot/img/i_2a584a74ff33d10d_html_1211789.jpg" NAME="Picture 33">
                    <P ALIGN=CENTER>
                        <I>Output Wires</I>
                    </P>
                </td>
            </tr>
        </table>

        <P><BR><BR><BR><BR></P>

        <table style="width:100%">
            <tr>
                <td style="width:50%">
                    <IMG style="display:block; width:100%" SRC="Projects/Robot/img/i_2a584a74ff33d10d_html_547c9350.jpg" NAME="Picture 36">
                    <P ALIGN=CENTER>
                        <I>View From Right</I>
                    </P>
                </td>
                <td>
                    <IMG style="display:block; width:100%" SRC="Projects/Robot/img/i_2a584a74ff33d10d_html_d7ff6074.jpg" NAME="Picture 35">
                    <P ALIGN=CENTER>
                        <I>View From Left</I>
                    </P>
                </td>
            </tr>

        </table>

        <P><BR><BR><BR><BR></P>

        <P STYLE="font-size:3vw">
            <a name="chpt27">2.7 Servos</a>
        </P>

        <table style="width:100%">
            <tr>
                <td style="width:60%">
                    <p ALIGN="justify" style="margin-right:5%">
                        After doing some research and shopping, I found
                        the best servo for this project to be the Tactic TSX55. They were
                        each under $20 and provided the large amount of torque required to
                        lift the robot.  The servos all function using a PWM signal,
                        with 1.5us being center of travel.  The TSX55 servos are high-torque,
                        heavy duty, metal gear, ball bearing servos capable of producing 203
                        oz/in of torque at full voltage. This is enough to support the weight
                        of all the hardware while providing extra power to support an
                        additional payload.  The leg servos are secured with screws and
                        zip-ties for easy removal, and the waist servo is held down by a
                        metal strap. Lastly, a small generic mini-servo is used to rotate the
                        range detector.  It only delivers around 20 oz-in of torque, which
                        consumes less than 0.5A at 5V, and is powered directly from the
                        system board power supply.
                    </p>
                </td>
                <td>
                    <TABLE style="width:100%">
                        <TR>
                            <TD COLSPAN=3 BGCOLOR="#548dd4" STYLE="border: 1px solid #00000a; padding: 0in 0.08in">
                                <P align="center">
                                    Tactic TSX55 Ball-Bearing Servo
                                </P>
                            </TD>
                        </TR>
                        <TR>
                            <TD BGCOLOR="#bfbfbf" STYLE="width:20%; border: 1px solid #00000a; padding: 0in 0.08in">
                                <P>Volts</P>
                            </TD>
                            <TD BGCOLOR="#bfbfbf" STYLE="width:30%; border: 1px solid #00000a; padding: 0in 0.08in">
                                <P>Torque</P>
                            </TD>
                            <TD BGCOLOR="#bfbfbf" STYLE="width:30%; border: 1px solid #00000a; padding: 0in 0.08in">
                                <P>Speed</P>
                            </TD>
                        </TR>
                        <TR>
                            <TD STYLE="border: 1px solid #00000a; padding: 0in 0.08in">
                                <P>4.8</P>
                            </TD>
                            <TD STYLE="border: 1px solid #00000a; padding: 0in 0.08in">
                                <P>181 oz-in</P>
                            </TD>
                            <TD STYLE="border: 1px solid #00000a; padding: 0in 0.08in">
                                <P>0.24 sec/60°</P>
                            </TD>
                        </TR>
                        <TR>
                            <TD STYLE="border: 1px solid #00000a; padding: 0in 0.08in">
                                <P>6.0</P>
                            </TD>
                            <TD STYLE="border: 1px solid #00000a; padding: 0in 0.08in">
                                <P>203 oz-in</P>
                            </TD>
                            <TD STYLE="border: 1px solid #00000a; padding: 0in 0.08in">
                                <P>0.21 sec/60°</P>
                            </TD>
                        </TR>
                        <TR VALIGN=TOP>
                            <TD COLSPAN=2 BGCOLOR="#bfbfbf" STYLE="border: 1px solid #00000a; padding: 0in 0.08in">
                                <P>Dimensions</P>
                            </TD>
                            <TD BGCOLOR="#bfbfbf" STYLE="border: 1px solid #00000a; padding: 0in 0.08in">
                                <P>Weight</P>
                            </TD>
                        </TR>
                        <TR VALIGN=TOP>
                            <TD COLSPAN=2 STYLE="border: 1px solid #00000a; padding: 0in 0.08in">
                                <P>1.6&quot; x 0.8&quot; x 1.5&quot;</P>
                            </TD>
                            <TD STYLE="border: 1px solid #00000a; padding: 0in 0.08in">
                                <P>2.1 oz (58 g)</P>
                            </TD>
                        </TR>
                    </TABLE>
                </td>
            </tr>
        </table>


        <P><BR><BR><BR><BR></P>

        <table style="width:100%">
            <tr>
                <td style="width:50%">
                    <IMG style="display:block; width:100%" SRC="Projects/Robot/img/i_2a584a74ff33d10d_html_431ae5d7.jpg" NAME="Picture 51">
                    <P ALIGN=CENTER>
                        <I>Waist Servo Installation</I>
                    </P>
                </td>
                <td>
                    <IMG style="display:block; width:100%" SRC="Projects/Robot/img/i_2a584a74ff33d10d_html_d41d85cf.jpg" NAME="Picture 53">
                    <P ALIGN=CENTER>
                        <I>Front Servo Installation</I>
                    </P>
                </td>
            </tr>

        </table>

        <P><BR><BR><BR><BR></P>

        <table style="width:100%">
            <tr>
                <td style="width:50%">
                    <IMG style="display:block; width:100%" SRC="Projects/Robot/img/i_2a584a74ff33d10d_html_69e13bc.jpg" NAME="Picture 54">
                    <P ALIGN=CENTER STYLE="margin-bottom: 0in; font-size:1vw">
                        <I>Rear Servo Installation</I>
                    </P>
                </td>
                <td>
                    <IMG style="display:block; width:100%" SRC="Projects/Robot/img/i_2a584a74ff33d10d_html_3a789463.jpg" NAME="Picture 52">
                    <P ALIGN=CENTER STYLE="margin-bottom: 0in">
                        <I>Linkages Calibrated</I>
                    </P>
                </td>
            </tr>

        </table>

        <P><BR><BR><BR><BR></P>

        <P STYLE="font-size:3vw">
            <a name="chpt28">2.8 Radar</a>
        </P>

        <P align="justify">
            The head unit was constructed solely as a radar platform. I used an
            HC-SR04 Ultrasonic Ranging Module for the range detection, which
            accurately detects ranges between 1 inch and 13 feet. This module is
            mounted to an electrically insulated plate using zip-ties, and the
            mounting plate can be manually adjusted up and down.  This assembly
            is mounted directly to a servo head with small screws, to allow
            precise scanning of the environment.  All radar components are
            powered directly from the System Board power supply, so the system
            can operate when only plugged into USB power.
        </P>

        <table style="width:100%">
            <tr>
                <td style="width:33%">
                    <IMG style="display:block; width:100%" SRC="Projects/Robot/img/i_2a584a74ff33d10d_html_35a3a061.jpg" NAME="Picture 4">
                </td>
                <td>
                    <IMG style="display:block; width:100%" SRC="Projects/Robot/img/i_2a584a74ff33d10d_html_9a8039d7.jpg" NAME="graphics1">
                </td>
                <td>
                    <IMG style="display:block; width:100%" SRC="Projects/Robot/img/i_2a584a74ff33d10d_html_65f62344.jpg" NAME="Picture 6">
                </td>
            </tr>
            <tr>
                <td colspan="3">
                    <P ALIGN=CENTER>
                        <I>Radar Assembly </I>
                    </P>
                </td>
            </tr>
        </table>

        <P><BR><BR><BR><BR></P>

        <P STYLE="font-size:5vw">
            <a name="chpt3">3 Software</a>
        </P>

        <P><BR><BR></P>

        <P STYLE="font-size:3vw">
            <a name="chpt31">3.1 Leg Geometry</a>
        </P>

        <table style="width:100%">
            <tr>
                <td colspan="2">
                    <p align="justify">
                        The leg hardware for the servos have been carefully tuned and
                        measured for each leg.  Exact distances between key points of the
                        movable legs are essential for geometric calculations to be
                        performed. The Law of Cosines is used for determining the appropriate
                        servo angles. First, the origin of the coordinate system is placed
                        exactly at the shoulder joint, and the target (X,Y) coordinates are
                        relative of that. It can then solve the distance and angle of the
                        line from the origin to the point (X,Y), giving both the length of
                        the third side of the red triangle and also its rotation. It can then
                        use the Law of Cosines to calculate the angle of the corner that
                        touches the servo, and subtract the red triangle's degree of rotation
                        to determine our servo angle.  Once it solves the angle of the bottom
                        servo, it can calculate all points along the red triangle, such as
                        the point where the green triangle meets the leg. With that, it can
                        then calculate the distance between that point and the top servo,
                        solving the length of the third side of the green triangle. Using the
                        Law of Cosines again, it can solve for the angle of the top servo.
                    </p>
                </td>
            </tr>
            <tr>
                <td style="width:50%">
                    <IMG style="display:block; width:100%" SRC="Projects/Robot/img/i_2a584a74ff33d10d_html_8416a759.png" NAME="Picture 1">
                    <P align="center">
                        Figure 4: Leg Geometry
                    </P>
                </td>
                <td>
                    <IMG style="display:block; width:100%" SRC="Projects/Robot/img/i_2a584a74ff33d10d_html_634c2e9b.png" NAME="Picture 61"><BR>
                    <P align="center">
                        Figure 5: Law of Cosines
                    </P>
                </td>
            </tr>
        </table>

        <P><BR><BR></P>

        <P STYLE="font-size:3vw">
            <a name="chpt32">3.2 Pivot Compensation</a>
        </P>

        <P align="justify">
            As the frame pivots, the feet naturally rotate with it. This causes a
            skewed placement of the feet which will disrupt the center of
            balance.  In this design, the feet automatically compensate their
            horizontal positions to maintain a square base. The entire range of
            motion for each foot is offset by this amount to allow smooth
            transitions as the frame pivots left and right.
        </P>
        <table style="width:100%">
            <tr>
                <td style="width:33%">
                    <IMG style="display:block; width:100%" SRC="Projects/Robot/img/i_2a584a74ff33d10d_html_76b05153.jpg" NAME="Picture 46">
                </td>
                <td style="width:33%">
                    <IMG style="display:block; width:100%" SRC="Projects/Robot/img/i_2a584a74ff33d10d_html_ab8ecf37.jpg" NAME="Picture 48">
                </td>
                <td style="width:33%">
                    <IMG style="display:block; width:100%" SRC="Projects/Robot/img/i_2a584a74ff33d10d_html_4967dd88.jpg" NAME="Picture 47"><BR>
                </td>
            </tr>
            <tr>
                <td colspan="3">
                    <p align="center">
                        Figure 6: Pivot compensation
                    </p>
                </td>
            </tr>

        </table>
 
        <P><BR><BR><BR><BR></P>

        <P STYLE="font-size:3vw">
            <a name="chpt33">3.3 Graphics</a>
        </P>

        <P ALIGN=JUSTIFY>
            The graphics display shows the current status of the
            robot. The four leg positions are drawn to scale and show the current
            calculated positions of each servo.  The command being executed is
            displayed at the top, above the legs.  The Roll and Pitch that is
            used to maintain stability are both displayed in real time, as well
            as the predicted yaw heading.  The radar map is kept in the bottom
            corner and is a representation of the distances found by the range
            finder. The orientation of the head is also synchronized with a red
            sweeping line inside the radar map.
        </p>
        <IMG style="display:block; width:100%" SRC="Projects/Robot/img/i_2a584a74ff33d10d_html_bba21330.jpg" NAME="Picture 8">
        
        <P><BR><BR><BR><BR></P>


        <P STYLE="font-size:3vw">
            <a name="chpt34">3.4 Self Leveling</a>
        </P>

        <table style="width:100%">
            <tr>
                <td style="width:40%">
                    <P ALIGN=JUSTIFY style="margin-right:5%">
                        This robot can automatically compensate the height of
                        each leg to maintain a level orientation. Roll and pitch are
                        independently monitored and adjustments are made for each
                        two-dimensional plane. The robot will slowly adjust all four legs,
                        for each axis, in an attempt to bring roll and pitch values back to
                        0. To maintain symmetry, legs are adjusted in pairs and are moved
                        opposite of each other to maintain the same average height.  Limits
                        are placed on these adjustments to stay within the hardware limit of
                        travel.
                    </P>
                </td>
                <td style="width:30%">
                    <IMG style="display:block; width:100%" SRC="Projects/Robot/img/i_2a584a74ff33d10d_html_42694a8c.jpg" NAME="Picture 11">
                </td>
                <td>
                    <IMG style="display:block; width:100%" SRC="Projects/Robot/img/i_2a584a74ff33d10d_html_3949f897.jpg" NAME="Picture 12">
                </td>
            </tr>
            <tr>
                <td>
                    <P ALIGN=JUSTIFY STYLE="margin-right:5%">
                        The speed at which this system responds can cause
                        extremely unstable conditions. If the reaction speed is too fast, the
                        legs will overshoot their target, and the extra momentum can result
                        in an unrecoverable side-to-side oscillation.  By using multiple
                        equations, it can react differently for each range of roll and pitch
                        values. This allows it to make quick gross adjustments, while still
                        reducing the speed gracefully as it reaches zero. Large roll angles
                        are defined to detect a roll-over, and to avoid overreactions near
                        the tipping point.
                    </P>
                </td>
                <td colspan="2">
                    <IMG style="display:block; width:100%" SRC="Projects/Robot/img/i_2a584a74ff33d10d_html_10c58524.jpg" NAME="graphics2">
                </td>
            </tr>
            <tr>
                <td>
                    <P ALIGN=JUSTIFY STYLE="margin-right: 5%">
                        The sensor data obtained from both the accelerometer
                        and gyroscope are used for a quaternion algorithm which computes them
                        as two vectors in a three-dimensional space. While in motion, this
                        algorithm produces estimated values for yaw, pitch, and roll. While
                        the robot is steady, gravity is used to calibrate center.
                    </P>
                </td>
                <td colspan="2">
                    <IMG style="display:block; width:100%" SRC="Projects/Robot/img/i_2a584a74ff33d10d_html_be7d0e32.jpg" NAME="graphics3">
                </td>
            </tr>
            <tr>
                <td>
                    <P ALIGN=JUSTIFY STYLE="margin-right: 5%">
                        Once calibrated, this system performed well on both a
                        tilt-table test, and an obstacle test.  The legs have a good natural
                        reaction to large events, and constant adjustments can keep it level
                        while in motion.
                    </P>
                </td>
                <td colspan="2">
                    <IMG style="display:block; width:100%" SRC="Projects/Robot/img/i_2a584a74ff33d10d_html_a69cfc7c.jpg" NAME="graphics4">
                </td>
            </tr>
            <tr>
                <td colspan="3">
                    <P ALIGN=CENTER>
                        <A HREF="Project/Robot/video/autolevel.mp4">Video here</A>
                    </P>
                </td>
            </tr>
        </table>

        <P><BR><BR><BR><BR></P>
        
        <P STYLE="font-size:3vw">
            <a name="chpt35">3.5 Walking</a>
        </P>
        <table style="width:100%">
            <tr>
                <td style="width:50%">
                    <P ALIGN=JUSTIFY style="margin-right:5%">
                        The walking algorithm was designed to keep the center of gravity balanced
                        within the 3 planted feet.  To create distinct phases of a step loop,
                        it is divided into 4 segments. The range of motion of the feet are
                        divided into 3 even segments and the 4th segment is a lift and place
                        routine, as shown in Figure 7.  Each foot is always in a unique phase
                        so that only one foot is stepping at a time, and stepping is
                        alternated from front to rear, one side at a time.
                    </P>
                </td>
                <td>
                    <IMG style="display:block; width:100%" SRC="Projects/Robot/img/i_2a584a74ff33d10d_html_7a2f3f96.jpg" NAME="Picture 22">
                    <P ALIGN=CENTER>
                        <i>Figure7: Step path</i>
                    </P>
                </td>
            </tr>
        </table>

        <p align="justify">
            As each side is stepping, the frame pivots away to adjust the center of gravity away
            from the lifted foot.  The auto-leveling routine is also sent
            configuration variables that cause it to roll and pitch away from the
            lifted foot.  This assists by preemptively orientating the robot away
            from falling when the foot is first picked up.  To further assist
            this function, each foot quickly presses down before lifting up,
            which causes the weight to securely rest on the red triangles shown
            in Figure 8.
        </P>
        
        <IMG style="display:block; width:100%" SRC="Projects/Robot/img/i_2a584a74ff33d10d_html_96bfc6f8.jpg" NAME="Picture 42"><BR>

        <P ALIGN=CENTER>
            <i>Figure 8: Walking Algorithm</i>
        </P>

        <P><BR><BR><BR><BR></P>

        <P ALIGN=CENTER>
            <A HREF="Projects/Robot/video/walking.mp4">Video here</A>
        </P>


        <P STYLE="font-size:3vw">
            <a name="chpt36">3.6 Radar</a>
        </P>

        <P ALIGN=JUSTIFY>
            The radar is used to detect objects that are in front of the robot.  The
            resolution is adjustable in the source code, and the range of motion
            was calibrated to the servo.  These variables are used to accurately
            display the radar map using the correct angles. As the range finder
            sweeps across the field, the distances are stored in an array, and a
            new line segment is drawn on the radar map. This system was designed
            to build a 2D map as it moved through the environment, but
            development is still in progress.
        </P>
        
        <IMG style="display:block; width:100%" SRC="Projects/Robot/img/i_2a584a74ff33d10d_html_946f528a.jpg" NAME="Picture 60">
        <P ALIGN=CENTER>
            <i>Figure 9: Radar Map</i>
        </P>
        
        <P ALIGN=JUSTIFY>
            The radar system operates by rotating the range finder to each point, in
            a back and forth sweeping motion, and activating the range finder at
            each one.  To activate the radar pulse, it sets the Trigger line high
            for 10us, and then measure the time until the falling edge occurs on
            the Echo line. It uses a falling-edge triggered hardware interrupt on
            the Echo line to maintain high precision.  This &quot;ping&quot; is
            repeated multiple times at each position to develop an average value
            to store in the array.
        </P>

        <P><BR><BR><BR><BR></P>

        <P STYLE="font-size:3vw">
            <a name="chpt37">3.7 Current Development</a>
        </P>

        <P STYLE="font-size:3vw; margin-left:5%">
                    Bluetooth Connection:
        </P>

        <P ALIGN=JUSTIFY STYLE="margin-left: 5%">
                Currently, commands must be entered into the source code before uploading.  By
                adding a Bluetooth module, more sophisticated controls can be
                developed. Development of an Android application to control the robot
                is in progress. Bluetooth could also allow access to a network of
                various remote devices to help direct commands, including the
                internet.  The hardware component will be added underneath the
                Gyro/Accel module and will also communicate on the SPI bus.

        </P>

        <P STYLE="font-size:3vw; margin-left:5%">
            Steering:
        </P>

        <P ALIGN=JUSTIFY STYLE="margin-left: 5%">
                To allow the robot to walk around obstacles,  a turning algorithm must
                still be developed.  While walking, the center of gravity restricts
                large variations from the normal algorithm.  I believe a modified
                walking algorithm that involves slipping the feet, pivoting the
                frame, and forcing a heavy roll can maintain center balance while
                turning.
        </P>

        <P STYLE="font-size:3vw; margin-left: 5%">
            Radar Based Route:
        </P>

        <P ALIGN=JUSTIFY STYLE="margin-left: 5%">
                Although the radar is collecting data and drawing a map, it is not affecting
                the actions of the robot.  Once steering has been developed, the
                radar values can be used to locate open routes and avoid obstacles.
                The (X,Y) coordinate system of the feet are calibrated in inches, so
                real distances can be used to build layers of data into a 2D map.
        </P>

        <P><BR><BR><BR><BR></P>

        <P STYLE="font-size:3vw">
            <a name="chpt38">3.8 Software Outline</a>
        </P>

        <UL>
            <li>
                <b>setup()</b>
                <UL>
                    <LI>load startup routine into memory</LI>
                    <LI>initialize servo pins</LI>
                    <LI>set PWM frequency</LI>
                    <LI>initialize range finder</LI>
                    <LI>initialize LCD screen</LI>
                    <LI>initialize gyro/accel</LI>
                    <LI>set head, legs, and waist to start position</LI>
                </UL>
            </li>
            <li>
                <B>Main loop()</B>
                <ul>
                    <li>calculate yaw, pitch, and roll >>> processGyro()</li>
                    <li>load next command into memory? >>> loadCommand()</li>
                    <li>load next movement of current command? >>> executeCommand()</li>
                    <li>adjust height of each leg to maintain level >>> autolevel()</li>
                    <li>adjust each servo to move feet to new locations >>> moveServo()</li>
                    <li>run radar routine to build radar map >>> sweep()</li>
                    <li>draw graphics to display >>> drawData()</li>
                </ul>
            </li>
            <li>
                <b>processGyro()</b>
                <ul>
                    <LI>Capture and adjust current gyro/accel values</LI>
                    <LI>Run Complementary filter algorithm to calculate Yaw, Pitch, and Roll</LI>
                </ul>
            </li>                
            <li>
                <B>loadCommand()</B>
                <ul>
                    <li>Check flag to verify the current command has completed</li>
                    <li>load movements for next command into memory</li>

                </ul>
            </li>
            <li>
                <B>executeCommand()	</B>
                <ul>
                    <li>Check that the current movement has completed</li>
                    <li>load next movement into global model to be executed by moveServo()</li>
                    <li>If entire command is complete, set flag to trigger loadCommand()</li>
                </ul>
            </li>
            <li>
                <B>autolevel()	</B>
                <ul>
                    <li>Calculate new pitch and roll values from locally stored gyro/accel data</li>
                    <li>Use various equations to calculate amount of leg height compensation to adjust</li>
                    <li>Calculate new pitch and roll values from locally stored gyro/accel data</li>
                    <li>Verify final values are within physical limits</li>
                </ul>
            </li>
            <li>
                <B>moveServo()</B>
                <ul>
                    <li>Calculate the progress % of time elapsed  / total time movement should take</li>
                    <li>Use preset equations and progress % to determine where each foot should be</li>
                    <li>Calculate foot compensation for any twisting at waist so feet remain parallel.</li>
                    <li>set waist servo to new position</li>
                     <li>call moveArm(leg, x, y)  for each leg</li>
                </ul>
            </li>
            <li>
                <B>moveArm(leg,x, y)</B>
                <ul>
                    <li>Use law of cosines to calculate angle of bottom servo</li>
                    <li>Use law of cosines to calculate angle of top servo</li>
                    <li>Convert angle into PWM value</li>
                    <li>Output PWM signal to servo</li>
                    
                </ul>
            </li>
            <li>
                <B>sweep()</B>
                <ul>
                    <li>send head servo to new position</li>
                    <li>wait for servo movement to complete, based on time</li>
                    <li>trigger radar pulse</li>
                    <li>wait for radar return and then store value</li>
                    <li>repeat radar ping to gather an average value</li>
                    <li>store final value and update radar map on LCD</li>
                </ul>
            </li>
            <li>
                <B>Interrupt Routines:</B>
                <ul>
                    <li>
                        <b>pulseEnd()</b>
                        <ul>
                            <li>subtract current time from start time to compute elapsed time of radar return</li>
                            <li>set dataReady flag to true</li>
                        </ul>    
                    </li>
                    <li>
                        <B>readMPU()</B>
                        <ul>
                            <li>new gyro/accel data is ready, copy values from registers into local variables</li>
                        </ul>
                    </li>
                </ul>
            </li>

        </UL>

        <P ALIGN=CENTER STYLE="margin-bottom: 0in">
            Arduino Source Code:
            <A HREF="http://homes.cs.washington.edu/~alexvass/Robot/RobotWalking_v3.ino">http://homes.cs.washington.edu/~alexvass/Robot/RobotWalking_v3.ino</A>
        </P>
        <P ALIGN=CENTER STYLE="margin-bottom: 0in">
            <BR>
        </P>
        <P ALIGN=CENTER STYLE="margin-bottom: 0in">
            Video Walkthrough:
            <A HREF="http://homes.cs.washington.edu/~alexvass/Robot/RobotDemo.avi">http://homes.cs.washington.edu/~alexvass/Robot/RobotDemo.avi</A>
        </P>

    </div>
</div>